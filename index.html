<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>777 æ‹‰éœ¸æŠ½ç±¤ï¼ˆè‡ªæˆ‘æ’é™¤ï¼‹ä¸é‡è¤‡ï¼‰</title>
  <style>
    :root{
      --bg:#0b0f1a;
      --panel:#111a2d;
      --panel2:#0f1730;
      --gold:#f6d365;
      --gold2:#fda085;
      --txt:#f3f6ff;
      --muted:#aab3cc;
      --danger:#ff5a7a;
      --ok:#33d17a;
      --font: 22px;
      --font-big: 34px;
      --r:18px;
    }
    body{
      margin:16px;
      font-family:-apple-system,BlinkMacSystemFont,"Noto Sans TC",system-ui,"Segoe UI",Arial;
      background: radial-gradient(1200px 800px at 20% 10%, #1a2a6c33, transparent 55%),
                  radial-gradient(1000px 700px at 90% 20%, #b21f1f22, transparent 55%),
                  radial-gradient(1200px 800px at 50% 90%, #fdbb2d22, transparent 55%),
                  var(--bg);
      color:var(--txt);
      font-size:var(--font);
      line-height:1.45;
    }
    h1{ margin:0 0 10px; font-size:28px; letter-spacing:.5px; }
    .muted{ color:var(--muted); font-size:18px; }
    .card{
      background: linear-gradient(180deg, #121b33, #0d1326);
      border: 1px solid #22305a;
      border-radius: var(--r);
      padding:16px;
      margin:14px 0;
      box-shadow: 0 12px 30px rgba(0,0,0,.35);
    }
    .row{ display:flex; gap:14px; flex-wrap:wrap; align-items:center; }
    .pill{
      display:inline-flex; gap:10px; align-items:center;
      padding:10px 14px;
      border-radius: 999px;
      border:1px solid #2a3a6d;
      background: #0b1227;
      font-size:20px;
    }
    .big{ font-size:var(--font-big); font-weight:900; letter-spacing:.5px; }
    button{
      font-size:22px;
      padding:14px 18px;
      border-radius: 16px;
      border:2px solid #ffffff22;
      background: linear-gradient(180deg, #23315c, #17234a);
      color:var(--txt);
      font-weight:900;
      cursor:pointer;
      box-shadow: 0 10px 20px rgba(0,0,0,.35);
    }
    button:disabled{ opacity:.45; cursor:not-allowed; }

    /* Pick-me list */
    .radioList{ display:grid; grid-template-columns: 1fr; gap:10px; margin-top:12px; }
    .radioItem{
      display:flex; align-items:center; gap:14px;
      padding:14px;
      border-radius: 16px;
      border: 1px solid #2a3a6d;
      background: #0b1227;
    }
    .radioItem input[type="radio"]{ width:28px; height:28px; }
    .radioItem b{ font-size:24px; }

    /* SLOT MACHINE */
    .machine{
      width: min(980px, 100%);
      margin: 0 auto;
      border-radius: 26px;
      background: linear-gradient(180deg, #1b2a57, #101a36);
      border: 2px solid #2a3a6d;
      box-shadow: 0 30px 70px rgba(0,0,0,.55);
      overflow:hidden;
      position: relative;
    }
    .marquee{
      display:flex; align-items:center; justify-content:center;
      padding:12px 14px;
      background: linear-gradient(90deg, #f6d365, #fda085);
      color:#1a1230;
      font-weight: 1000;
      letter-spacing: 3px;
      text-transform: uppercase;
      font-size: 22px;
    }
    .marquee .dots{
      margin-left:10px;
      font-weight:900;
      letter-spacing: 8px;
    }
    .machineBody{
      padding: 16px;
      display:grid;
      grid-template-columns: 1fr 170px;
      gap: 14px;
      align-items: start;
    }
    @media (max-width: 820px){
      .machineBody{ grid-template-columns: 1fr; }
    }

    .reelsWrap{
      background: linear-gradient(180deg, #0d1326, #0a1022);
      border: 1px solid #24335f;
      border-radius: 22px;
      padding: 16px;
      position:relative;
    }

    .reels{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      align-items: stretch;
    }
    .reel{
      height: 160px;
      border-radius: 18px;
      border: 2px solid #2a3a6d;
      background: linear-gradient(180deg, #0b1227, #070b18);
      position: relative;
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:center;
      box-shadow: inset 0 0 0 2px rgba(255,255,255,.03);
    }
    .reel::before{
      content:"";
      position:absolute; inset:0;
      background: linear-gradient(180deg, rgba(255,255,255,.18), transparent 30%, transparent 70%, rgba(0,0,0,.35));
      pointer-events:none;
    }
    .window{
      position:absolute;
      left:10px; right:10px;
      top:50%; transform: translateY(-50%);
      height: 68px;
      border-radius: 14px;
      border: 2px solid #ffffff22;
      background: rgba(255,255,255,.06);
      box-shadow: 0 0 0 2px rgba(0,0,0,.25) inset;
      pointer-events:none;
    }
    .reelText{
      font-size: 34px;
      font-weight: 1000;
      letter-spacing: .8px;
      text-shadow: 0 3px 0 rgba(0,0,0,.35);
    }
    .glow{
      position:absolute; inset:-30px;
      background: radial-gradient(closest-side, rgba(253,160,133,.20), transparent 60%);
      filter: blur(0px);
      opacity: .0;
      transition: opacity .25s ease;
      pointer-events:none;
    }
    .spinning .glow{ opacity: .9; }

    .statusBar{
      margin-top: 12px;
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items:center;
      justify-content: space-between;
    }
    .resultBox{
      margin-top: 12px;
      border-radius: 18px;
      border: 1px solid #2a3a6d;
      background: #0b1227;
      padding: 14px;
    }
    .ok{ color: var(--ok); }
    .danger{ color: var(--danger); }

    /* Lever */
    .leverPanel{
      border-radius: 22px;
      border: 1px solid #24335f;
      background: linear-gradient(180deg, #0b1227, #070b18);
      padding: 16px;
      position: relative;
      min-height: 320px;
    }
    .leverTitle{ font-weight: 1000; letter-spacing: 1px; }
    .leverHint{ color:var(--muted); font-size: 18px; margin-top:6px; }
    .leverTrack{
      margin-top: 14px;
      height: 210px;
      border-radius: 999px;
      background: linear-gradient(180deg, #16244a, #0a1022);
      border: 2px solid #2a3a6d;
      position: relative;
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .leverFill{
      position:absolute; left:0; right:0; bottom:0;
      height: 0%;
      background: linear-gradient(180deg, #f6d365, #fda085);
      opacity: .85;
      transition: height .04s linear;
    }
    .leverKnob{
      width: 88px; height: 88px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #fff, #f6d365 30%, #fda085 70%, #c94a2f);
      border: 3px solid #ffffff33;
      box-shadow: 0 18px 30px rgba(0,0,0,.55);
      position:absolute;
      top: 12px;
      left: 50%;
      transform: translateX(-50%);
      touch-action: none;
    }
    .leverKnob::after{
      content:"";
      position:absolute; inset:10px;
      border-radius: 50%;
      background: rgba(255,255,255,.22);
      filter: blur(0px);
    }
    .leverLine{
      position:absolute;
      top: 0; bottom: 0;
      left: 50%;
      width: 6px;
      transform: translateX(-50%);
      background: linear-gradient(180deg, #ffffff22, #00000055);
      border-radius: 999px;
    }

    .smallBoxes{
      margin-top: 12px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 820px){
      .smallBoxes{ grid-template-columns: 1fr; }
    }
    .listBox{
      max-height: 220px;
      overflow:auto;
      border: 1px solid #2a3a6d;
      border-radius: 18px;
      padding: 10px 14px;
      background: #0b1227;
    }
    .listBox div{ padding: 7px 0; border-bottom: 1px dashed #2a3a6d; }
    .listBox div:last-child{ border-bottom:0; }
  </style>
</head>

<body>
  <h1>ğŸ° 777 æ‹‰éœ¸æŠ½ç±¤ï¼ˆæ’é™¤æˆ‘è‡ªå·±ï¼‹å·²æŠ½éï¼‰</h1>
  <div class="muted">å…ˆé¸ã€Œæˆ‘æ˜¯èª°ã€â†’ é–‹å§‹ â†’ æ¯æ¬¡æ‹‰æ¡¿æŠ½ 1 äººï¼ŒæŠ½åˆ°å°±ç§»é™¤ï¼Œä¸é‡è¤‡ã€‚</div>

  <!-- STEP 1 -->
  <div class="card" id="stepPickMe">
    <div class="big">1) ä½ æ˜¯èª°ï¼Ÿï¼ˆå–®é¸ï¼‰</div>
    <div class="radioList" id="radioList"></div>
    <div class="row" style="margin-top:14px;">
      <button id="btnStart" disabled>é–‹å§‹ï¼ˆæ’é™¤æˆ‘è‡ªå·±ï¼‰</button>
      <span class="muted" id="pickHint">è«‹å…ˆé¸ä¸€å€‹äººå</span>
    </div>
  </div>

  <!-- STEP 2 -->
  <div class="card" id="stepDraw" style="display:none;">
    <div class="row">
      <span class="pill">æˆ‘è‡ªå·±ï¼š<b id="meName">â€”</b>ï¼ˆå·²æ’é™¤ï¼‰</span>
      <span class="pill">å‰©é¤˜ï¼š<b id="remainCount">0</b> äºº</span>
      <span class="pill">ç‹€æ…‹ï¼š<b id="stateText">å¾…æŠ½</b></span>
    </div>

    <div class="machine" style="margin-top:14px;">
      <div class="marquee">777 LUCKY DRAW <span class="dots">â— â— â—</span></div>

      <div class="machineBody">
        <!-- Reels -->
        <div class="reelsWrap" id="reelsWrap">
          <div class="reels">
            <div class="reel">
              <div class="glow"></div>
              <div class="window"></div>
              <div class="reelText" id="reel1">â€”</div>
            </div>
            <div class="reel">
              <div class="glow"></div>
              <div class="window"></div>
              <div class="reelText" id="reel2">â€”</div>
            </div>
            <div class="reel">
              <div class="glow"></div>
              <div class="window"></div>
              <div class="reelText" id="reel3">â€”</div>
            </div>
          </div>

          <div class="resultBox">
            <div class="big" id="result">æ‹‰æ¡¿é–‹å§‹æŠ½</div>
            <div class="muted" id="status">æç¤ºï¼šæŠŠå³é‚Šæ‹‰æ¡¿å¾€ä¸‹æ‹‰åˆ°åº•ï¼Œæ”¾é–‹å³å¯æŠ½ã€‚</div>
          </div>

          <div class="statusBar">
            <button id="btnResetAll" style="border-color:#ffffff22;">å…¨éƒ¨é‡ä¾†</button>
            <div class="muted">ï¼ˆRAND æŠ½ç±¤ï¼šæ¯æ¬¡åœ¨å‰©é¤˜åå–®ä¸­å…¬å¹³éš¨æ©Ÿï¼‰</div>
          </div>
        </div>

        <!-- Lever -->
        <div class="leverPanel">
          <div class="leverTitle">æ‹‰æ¡¿</div>
          <div class="leverHint">å¾€ä¸‹æ‹‰åˆ°åº• â†’ æ”¾é–‹æŠ½</div>

          <div class="leverTrack" id="leverTrack">
            <div class="leverFill" id="leverFill"></div>
            <div class="leverLine"></div>
            <div class="leverKnob" id="leverKnob" aria-label="lever"></div>
          </div>

          <div class="row" style="margin-top:12px;">
            <button id="btnPull" style="width:100%;">æˆ‘æ‡¶å¾—æ‹‰ï¼šç›´æ¥æŠ½</button>
          </div>

          <div class="muted" style="margin-top:10px;">
            å°æç¤ºï¼šiPhone ä¸Šç”¨æ‰‹æŒ‡æ‹–æ‹‰æ‰‹æŠŠæœ€æœ‰æ„Ÿã€‚
          </div>
        </div>
      </div>
    </div>

    <div class="smallBoxes">
      <div>
        <div style="font-weight:1000; margin-bottom:8px;">å·²æŠ½é †åº</div>
        <div class="listBox" id="historyBox"></div>
      </div>
      <div>
        <div style="font-weight:1000; margin-bottom:8px;">å·²æ’é™¤åå–®ï¼ˆå«æˆ‘è‡ªå·±ï¼‹å·²æŠ½éï¼‰</div>
        <div class="listBox" id="excludedBox"></div>
      </div>
    </div>
  </div>

<script>
  // ===== åå–®ï¼ˆåªæ”¹é€™è£¡ï¼‰=====
  const ALL_NAMES = ["ç‰","å†°","éˆ","ç´…","è‘‰","ç™½","åº•","è±†","å®","7","å¤§é›„","Allen"];

  // ===== State =====
  let me = null;
  let remaining = [];
  let excluded = new Set();
  let history = [];
  let busy = false;

  // ===== Elements =====
  const radioList = document.getElementById("radioList");
  const btnStart = document.getElementById("btnStart");
  const pickHint = document.getElementById("pickHint");

  const stepPickMe = document.getElementById("stepPickMe");
  const stepDraw = document.getElementById("stepDraw");

  const meName = document.getElementById("meName");
  const remainCount = document.getElementById("remainCount");
  const stateText = document.getElementById("stateText");

  const reelsWrap = document.getElementById("reelsWrap");
  const reel1 = document.getElementById("reel1");
  const reel2 = document.getElementById("reel2");
  const reel3 = document.getElementById("reel3");

  const result = document.getElementById("result");
  const status = document.getElementById("status");

  const historyBox = document.getElementById("historyBox");
  const excludedBox = document.getElementById("excludedBox");

  const btnResetAll = document.getElementById("btnResetAll");
  const btnPull = document.getElementById("btnPull");

  const leverTrack = document.getElementById("leverTrack");
  const leverKnob = document.getElementById("leverKnob");
  const leverFill = document.getElementById("leverFill");

  // ===== Crypto RNG helper (æ›´ç©©çš„ RAND) =====
  function randInt(maxExclusive){
    if (maxExclusive <= 0) return 0;
    const a = new Uint32Array(1);
    crypto.getRandomValues(a);
    return a[0] % maxExclusive;
  }

  // ===== UI =====
  function renderPickMe(){
    radioList.innerHTML = "";
    ALL_NAMES.forEach((name, idx) => {
      const label = document.createElement("label");
      label.className = "radioItem";

      const input = document.createElement("input");
      input.type = "radio";
      input.name = "me";
      input.value = name;
      input.id = "me_" + idx;

      input.addEventListener("change", () => {
        me = name;
        btnStart.disabled = false;
        pickHint.textContent = `å·²é¸ï¼š${me}`;
        pickHint.className = "muted";
      });

      const text = document.createElement("b");
      text.textContent = name;

      label.appendChild(input);
      label.appendChild(text);
      radioList.appendChild(label);
    });
  }

  function initGame(){
    if(!me) return;

    busy = false;
    excluded = new Set([me]);
    remaining = ALL_NAMES.filter(n => n !== me);
    history = [];

    meName.textContent = me;
    remainCount.textContent = remaining.length;
    stateText.textContent = "å¾…æŠ½";

    reel1.textContent = "â€”";
    reel2.textContent = "â€”";
    reel3.textContent = "â€”";

    result.textContent = "æ‹‰æ¡¿é–‹å§‹æŠ½";
    status.textContent = "æç¤ºï¼šæŠŠå³é‚Šæ‹‰æ¡¿å¾€ä¸‹æ‹‰åˆ°åº•ï¼Œæ”¾é–‹å³å¯æŠ½ã€‚";

    renderHistory();
    renderExcluded();

    stepPickMe.style.display = "none";
    stepDraw.style.display = "block";

    setLever(0);
  }

  function renderHistory(){
    historyBox.innerHTML = "";
    if(history.length === 0){
      historyBox.innerHTML = `<div class="muted">ï¼ˆå°šæœªæŠ½å‡ºä»»ä½•äººï¼‰</div>`;
      return;
    }
    history.forEach((n, i) => {
      const div = document.createElement("div");
      div.innerHTML = `<b>#${i+1}</b>ã€€${n}`;
      historyBox.appendChild(div);
    });
  }

  function renderExcluded(){
    excludedBox.innerHTML = "";
    const arr = Array.from(excluded);
    if(arr.length === 0){
      excludedBox.innerHTML = `<div class="muted">ï¼ˆç›®å‰æ²’æœ‰æ’é™¤ï¼‰</div>`;
      return;
    }
    arr.forEach(n => {
      const div = document.createElement("div");
      div.innerHTML = (n === me) ? `ğŸ‘¤ <b>${n}</b>ï¼ˆæˆ‘è‡ªå·±ï¼‰` : `ğŸš« ${n}`;
      excludedBox.appendChild(div);
    });
  }

  function setLever(p){ // p: 0..1
    const track = leverTrack.getBoundingClientRect();
    const topPad = 12;
    const bottomPad = 12;
    const knobH = 88;
    const usable = track.height - topPad - bottomPad - knobH;

    const y = topPad + usable * p;
    leverKnob.style.top = y + "px";
    leverFill.style.height = Math.round(p * 100) + "%";
  }

  // ===== Spin animation =====
  function pickWinner(){
    if(remaining.length === 0) return null;
    const idx = randInt(remaining.length);
    const picked = remaining.splice(idx, 1)[0];
    excluded.add(picked);
    history.push(picked);
    remainCount.textContent = remaining.length;
    return picked;
  }

  function startSpin(){
    if(busy) return;
    if(remaining.length === 0){
      result.textContent = "âœ… å…¨éƒ¨éƒ½æŠ½å®Œäº†";
      status.textContent = "æ²’æœ‰å‰©é¤˜äººå“¡å¯ä»¥æŠ½ã€‚";
      stateText.textContent = "å®Œæˆ";
      return;
    }

    busy = true;
    stateText.textContent = "è½‰å‹•ä¸­";
    reelsWrap.classList.add("spinning");
    result.textContent = "ğŸ° è½‰å‹•ä¸­â€¦";
    status.textContent = "è«‹ç¨ç­‰ï¼Œæ­£åœ¨æŠ½ç±¤ï¼ˆRANDï¼‰";

    // è½‰å‹•æ™‚éš¨æ©Ÿé¡¯ç¤ºåå­—ï¼ˆè¦–è¦ºç”¨ï¼‰
    const poolForVisual = remaining.length ? remaining : ALL_NAMES.filter(n => n !== me);
    const getVisual = () => poolForVisual[randInt(poolForVisual.length)];

    let t1 = 0, t2 = 0, t3 = 0;
    const i1 = setInterval(()=>{ reel1.textContent = getVisual(); t1++; }, 60);
    const i2 = setInterval(()=>{ reel2.textContent = getVisual(); t2++; }, 70);
    const i3 = setInterval(()=>{ reel3.textContent = getVisual(); t3++; }, 80);

    // çœŸæ­£çš„ä¸­çè€…ï¼ˆRANDï¼‰â€”ä¸å—è¦–è¦ºå½±éŸ¿
    const winner = pickWinner();

    // åˆ†æ®µåœæ­¢ï¼ˆåƒ 777ï¼‰
    setTimeout(()=>{
      clearInterval(i1);
      reel1.textContent = winner;
    }, 850);

    setTimeout(()=>{
      clearInterval(i2);
      reel2.textContent = winner;
    }, 1250);

    setTimeout(()=>{
      clearInterval(i3);
      reel3.textContent = winner;

      reelsWrap.classList.remove("spinning");
      result.innerHTML = `ğŸ‰ æŠ½åˆ°ï¼š<span class="ok">${winner}</span>`;
      status.textContent = `å·²å°‡ã€Œ${winner}ã€æ’é™¤ï¼Œä¸‹ä¸€è¼ªä¸æœƒå†æŠ½åˆ°ã€‚`;
      renderHistory();
      renderExcluded();

      if(remaining.length === 0){
        stateText.textContent = "å®Œæˆ";
        status.textContent = "âœ… å·²æŠ½å®Œæ‰€æœ‰äººï¼ˆé™¤äº†ä½ è‡ªå·±ï¼‰ã€‚";
      }else{
        stateText.textContent = "å¾…æŠ½";
      }

      busy = false;
      // æ‹‰æ¡¿å›å½ˆ
      setLever(0);
    }, 1650);
  }

  // ===== Lever drag (pull-to-spin) =====
  let dragging = false;
  let pull = 0; // 0..1

  function pointerY(e){
    if(e.touches && e.touches[0]) return e.touches[0].clientY;
    return e.clientY;
  }

  function onStart(e){
    if(busy) return;
    if(remaining.length === 0) return;
    dragging = true;
    e.preventDefault();
  }

  function onMove(e){
    if(!dragging) return;
    const track = leverTrack.getBoundingClientRect();
    const y = pointerY(e);
    const p = (y - track.top) / track.height;
    pull = Math.min(1, Math.max(0, p));
    setLever(pull);
    e.preventDefault();
  }

  function onEnd(){
    if(!dragging) return;
    dragging = false;

    // å¿…é ˆæ‹‰åˆ°åº•ï¼ˆ>= 0.92ï¼‰æ‰è§¸ç™¼æŠ½
    if(pull >= 0.92){
      startSpin();
    }else{
      // æ²’æ‹‰åˆ°åº•å°±å›å½ˆ
      setLever(0);
    }
    pull = 0;
  }

  leverKnob.addEventListener("touchstart", onStart, {passive:false});
  leverKnob.addEventListener("touchmove", onMove, {passive:false});
  leverKnob.addEventListener("touchend", onEnd);

  leverKnob.addEventListener("mousedown", onStart);
  window.addEventListener("mousemove", onMove);
  window.addEventListener("mouseup", onEnd);

  // ===== Buttons =====
  btnStart.addEventListener("click", initGame);
  btnPull.addEventListener("click", startSpin);

  btnResetAll.addEventListener("click", () => {
    me = null;
    stepDraw.style.display = "none";
    stepPickMe.style.display = "block";
    btnStart.disabled = true;
    pickHint.textContent = "è«‹å…ˆé¸ä¸€å€‹äººå";
    const radios = document.querySelectorAll('input[name="me"]');
    radios.forEach(r => r.checked = false);
  });

  // ===== init =====
  renderPickMe();
</script>
</body>
</html>
